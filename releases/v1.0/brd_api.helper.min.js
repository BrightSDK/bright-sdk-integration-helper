!function(){var n,t,e=!1,o=!1,i="bright_sdk.status",u=localStorage.getItem(i),s=function(){e&&console.log.apply(console,arguments)},c=function(){o&&console.error.apply(console,arguments)},r=[],a=!1,l=!1,f={init:function(n){return e=n.debug,o=n.debug||n.verbose,l=n.simple_opt_out,new Promise(function(t,e){f.getBrightApi(!1).then(function(o){s("init with settings: %o",n);var i=n.on_status_change,l=n.skip_consent;n.external_consent_options&&(f.createDialog(n),n.external_consent_options=void 0,n.skip_consent=!0,n.simple_opt_out=void 0),n.on_status_change=function(){try{var n=o.get_status(),t=n?n.value?n.value.consent:n.consent:null;f.onStatusChangeFn(t);for(var e=0;e<r.length;e++)r[e](t);r=[],i&&i(t)}catch(n){c(n)}};try{o.init(n,{on_failure:function(n){c("init failure. Error: ",n),e(new Error(n))},on_success:function(){s("init success"),a=!0,t(),l||u||f.showConsent(),f.showNotification(1e4)}})}catch(n){c(n),e()}})})},isInited:function(){return a},waitForStatusChange:function(){return Promise.resolve().then(function(){if(n)return n})},enable:function(n){return new Promise(function(t,e){return f.getBrightApi().then(function(o){if(!n)return f.onceStatusChange(t,"enableResolve",!0),f.showConsent().catch(e);o.external_opt_in({on_failure:function(n){c("external_opt_in failure",n),e()},on_success:function(){s("external_opt_in success"),t()}})})})},disable:function(){return u="disabled",f.waitForStatusChange().then(function(){return n=new Promise(function(n,t){f.onceStatusChange(n,"disableResolve",!0),f.getBrightApi().then(function(n){n.opt_out({on_failure:function(n){c("opt_out failure",n),u="enabled",t()},on_success:function(){s("opt_out success")}})})})})},showConsent:function(){if(t)return t.show(u);if(l){var n=new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:53,which:53,key:"5",code:"Digit5"});return document.dispatchEvent(n),Promise.resolve()}return new Promise(function(n,t){f.getBrightApi().then(function(e){e.show_consent({on_failure:function(n){c("show_consent failure: ",n),t(n)},on_success:function(){s("show_consent success"),n()}})})})},createDialog:function(n){if(window.ConsentModule){if(!t){var e=n.external_consent_options[0],o=n.external_consent_options[1];o.language=n.lang,l&&(o.Out=!0);var i,u=o.onShow,s=o.onAccept,r=o.onDecline,a=o.onClose;o.onAccept=function(){f.enable(!0),s&&s()},o.onDecline=function(){f.disable(),r&&r()},o.onShow=function(){i&&(document.removeEventListener("keydown",i,{capture:!0}),i=void 0),f.reportConsentShown(),u&&u()},o.onClose=function(){h(),a&&a()},t=ConsentModule.create(e,o),h()}}else c("ConsentModule not found, have you included it?");function h(){o.simpleOptOut&&(i=function(n){53==n.keyCode&&(n.preventDefault(),n.stopPropagation(),f.showConsent())},document.addEventListener("keydown",i,{capture:!0}))}},onceStatusChange:function(n,t,e){e||(r=[]);var o=r.length;r.push(function(e){s("calling once hook %d: %s",o,t),n(e)})},onStatusChangeFn:function(n){s("BRD status changed ----- ",n),null!=n&&(u=n?"enabled":"disabled",localStorage.setItem(i,u))},getStatus:function(){return u},getStatusObject:function(){return f.getBrightApi().then(function(n){return n.get_status()})},isEnabled:function(){return"enabled"==u},showNotification:function(n){t&&t.showNotification(n)},reportConsentShown:function(){return f.getBrightApi().then(function(n){n.consent_shown()})},getBrightApi:function(n,t){return void 0===n&&(n=!0),void 0===t&&(t=1e3),Promise.resolve().then(function(){return n&&!a||!window.brd_api?(c("BRD API not available, retry in 1 sec..."),(e=t,new Promise(function(n){setTimeout(n,e)})).then(function(){return f.getBrightApi(n,t)})):window.brd_api;var e})}};window.BrightSDK=f}();